@using Microsoft.JSInterop
@using System.Runtime.InteropServices
@using Append.Blazor.Notifications
@inject INotificationService NotificationService
@inherits LayoutComponentBase
@inject NavigationManager NavManager


<!-- <style>
    body { padding-top: 55px; padding-bottom: 110px; }
</style> -->

<div class="page">
    <div class="sidebar">
        <NavMenu /> 
    </div>

    <main>
        <article class="content px-4">
            <WebPlayer.Shared.PlayerUI.Player />
            @Body
        </article>
    </main>
</div>


<div id="streamURL" hidden>@AppState.StreamURL</div>

<audio controls hidden preload="auto" id="streamSourceElement" src="https://deependswamp.ddns.net:8443/deepend" type="audio/mpeg" crossorigin="anonymous"></audio>

@code {
    [CascadingParameter] public CascadingAppState AppState { get; set; }

    protected async Task ClockTick()
    {
        var periodicTimer = new PeriodicTimer(TimeSpan.FromSeconds(1));
        while (await periodicTimer.WaitForNextTickAsync())
        {
            AppState.Clock = DateTime.UtcNow;
        }
    }

    [Inject]
    public IJSRuntime JSRuntime { get; set; }

    private IJSObjectReference _jsModule;

    protected override async Task OnInitializedAsync()
    {
        _jsModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/webaudio.js");

        await _jsModule.InvokeVoidAsync("loadWebAudio");

        //ClockTick();
    }
}