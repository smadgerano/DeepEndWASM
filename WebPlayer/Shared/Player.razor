@using Microsoft.JSInterop
@inject IJSRuntime JS;

@if (AppState.BigPlayerUI)
{
    <div class="container">
        <div class="row">
            <div class="col-12" style="text-align: center;">
                <WebPlayer.Shared.PlayerUI.MasterButton FontSize="6em" FontColour="#212529e6"/>
            </div>
        </div>
        <div class="row">
            <div class="col-4">
                <EditForm Model="@requestForm" OnValidSubmit="@HandleValidSubmit">
                    <ValidationSummary />
                    <div class="mb-3 input-group ">
                        <InputSelect @bind-Value="requestForm.URL" class="form-control form-select-sm" id="streamName" >
            
                            @foreach (var item in streams )
                            { 
                                if(item.URL == AppState.StreamURL)
                                {
                                    <option selected value="@item.URL">@item.Country: @item.Name</option>
                                }
                                else
                                {
                                    <option value="@item.URL">@item.Country: @item.Name</option>
                                }
                            }
                        </InputSelect>
                        <button type="submit" class="btn-sm btn-success" onclick="video.load();">Go</button>  
                    </div>
                </EditForm> 
            </div>
        </div>
    </div>
}
else
{
    <footer class="footer mt-auto py-3 text-white fixed-bottom" style="background-color: #2c3136">
        <div class="container">
            <div class="row ">
                <div class="col-2" style="text-align: right;"> 
                    <WebPlayer.Shared.PlayerUI.MasterButton FontSize="3.2em" FontColour="#fbfbfb"/>
                </div>
                <div class="col-2 col-md-2 col-lg-2 col-xl-1 col-xxl-1 d-flex justify-content-center align-items-center" >
                    <input type="range" class="form-range" min="0" max="1" step="0.01" value="1" id="volumeSlider" onchange="showValue(this.value)" oninput="showValue(this.value)" > 
                </div>
                <div class="col-8 align-items-center">   
                    <div class="row">
                        <span class="h5">All About Something Deep</span>
                    </div>
                    <div class="row pt-0">
                        <span style="color: #adb5bd;"><em>Venus Theory</em></span>
                    </div> 
                </div>
            </div>
        </div>
    </footer>
}


@code {
    [CascadingParameter] public CascadingAppState AppState { get; set; }

    List<Data.StreamSource> streams = Data.Globals.StreamSources();

    protected override async Task OnInitializedAsync()
    {

    }

    private async Task PlayHowler()
    {
        await JS.InvokeVoidAsync("startHowlerPlayer");
        AppState.IsPlaying = true;
    }

    private async Task StopHowler()
    {
        await JS.InvokeVoidAsync("stopHowlerPlayer");
        AppState.IsPlaying = false;
    }

    private async Task HandleValidSubmit(EditContext editContext)
    {
        AppState.StreamURL = requestForm.URL;
        AppState.IsPlaying = false;

        var stream = new List<StreamURL> () { };

        stream.Add(new StreamURL { streamURL = AppState.StreamURL });       
                
        await JS.InvokeVoidAsync("switchHowlerStream", stream);
        AppState.IsPlaying = true;
    }

    private RequestForm requestForm = new(){ };

    public class RequestForm{
        public string? Name { get; set; }
        public string? Description { get; set; }
        public string? Country { get; set; }
        public string? URL { get; set; }
    }

    public class StreamURL
    {
        public string? streamURL {get; set; }
    }
}
