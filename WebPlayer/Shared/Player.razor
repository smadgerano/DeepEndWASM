@using Microsoft.JSInterop
@using System.Runtime.InteropServices
@inject Blazored.LocalStorage.ISyncLocalStorageService localSotrage
@inject NavigationManager Navigation

@if (AppState.BigPlayerUI)
{
    showBigPlayer = "visible";
    showSmallPlayer = "hidden";
}
else
{
    showBigPlayer = "hidden";
    showSmallPlayer = "visible";
}

@if (AppState.IsPlaying)
{
    masterButtonIcon = "fa-circle-pause";
}
else
{
    masterButtonIcon = "fa-circle-play";
}
<Animate Animation="Animations.FadeIn" Duration="TimeSpan.FromSeconds(0.3)" Delay="TimeSpan.FromSeconds(0)" Easing="Easings.EaseInOut">
    <div class="col-12">
        <div class="container" style="position:absolute; visibility:@showBigPlayer">

            <div class="row">
            <br /> 
            <div class="mb-3 col">
                <label for="dspPresetSelector" class="form-label"> <i id="dspGlobalEnableButtonIconLarge" class="fa-solid fa-microchip" style="color:#212529e6;"  ></i> DSP Mode</label>
                <select id="dspPresetSelector" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    <option selected value="1">Disabled</option>
                    <option value="2">1997 FM Smoothing</option>
                    <option value="3">1962 AM Old Vibes</option>
                    <option value="4">2003 Pirate Rude Boy</option>
                </select>
            </div>
            <div class="mb-3 col">
                <label for="streamSelectoDropListr" class="form-label"> <i class="fa-solid fa-earth-europe" style="color:#212529e6;"  ></i> Stream Source</label>
                <select id="streamSelectoDropListr" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    @foreach(StreamSource s in streams)
                    {
                        <option value="@s.URL">@s.Country@s.Description - @s.Name - @s.Rate</option>
                    }
                </select>
            </div>
        </div>

        <div class="row">
        </div>
        <br />
        <div class="row align-items-center" >
            <div class="col"></div>
            <div class="col" style="text-align: center;" justify-content-center align-items-center>
                <div id="masterButtonLarge">
                    <span class="h1" style="font-size:6em;">
                        <i id="masterButtonIconLarge" class="fa-regular @masterButtonIcon" style="color:#212529e6;" onclick="@TogglePlayState" ></i>
                    </span>
                </div>                    
            </div>
           <div class="col"></div>
        </div>
        <br />
        <div class="row">
             <div class="col " style="text-align: center;" >

                <label class="col-form-label"> <i class="fa-regular fa-thumbs-up" style="color:#212529e6;" ></i> Rating</label>

                <div class="row" > 
             
                    <div class="col">
                       <i class="fa-solid fa-ship" style="color:#212529e6; font-size:1.5em;"  data-bs-toggle="tooltip" data-bs-placement="top" title="Boat stealing music"></i> 
                      </div>
                    <div class="col">
                        <i class="fa-solid fa-hotdog" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="Fat sausage"></i> 
                    </div>
                    <div class="col">
                    <i class="fa-solid fa-fire" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="This is FIRE!"></i> 
                    </div>
                    <div class="col">   
                    <i class="fa-solid fa-pepper-hot" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="That's spicy"></i> 
                    </div>
                    <div class="col">   
                    <i class="fa-solid fa-trophy" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="This is a winner"></i> 
                    </div>
                    <div class="col">    
                    <i class="fa-solid fa-hand-sparkles" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="This slaps HARD"></i> 
                    </div>
                    <div class="col">  
                    <i class="fa-solid fa-mug-saucer" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="Chill vibes" ></i> 
                    </div>
                    <div class="col">
                    <i class="fa-regular fa-circle" style="color:#212529e6; font-size:1.5em;" data-bs-toggle="tooltip" data-bs-placement="top" title="- - - v o i d - - -"></i> 
                    </div>
                  
                </div>
                   
            </div>
        </div>
        <br />
         <div class="row">
            <div class="col" style="text-align: center;" justify-content-center align-items-center >
                <label for="waapiVolumeSliderBigUI" class="col-form-label"> <i id="dspGlobalEnableButtonIconLarge" class="fa-solid fa-volume-high" style="color:#212529e6;"  ></i> Volume</label>
                <input type="range" class="form-range" min="0.0" max="1.0" step="0.01" @bind-value="@AppState.Volume" id="waapiVolumeSliderBigUI" > 
            </div>
        </div>
        <br />
        <br />
        <br />
        <br />
        </div>
    </div>
</Animate>

<footer class="footer mt-auto py-3 pb-2 pt-2 text-white fixed-bottom" style="background-color: #2c3136; visibility:@showSmallPlayer">
    <Animate Animation="Animations.FadeIn" Duration="TimeSpan.FromSeconds(0.3)" Delay="TimeSpan.FromSeconds(0)" Easing="Easings.EaseInOut">
        <div class="container" >           
            <div class="row align-items-center">
                <div class="col-2 align-items-center" style="text-align: right;"> 
                    <div id="masterButtonSmall">
                        <span class="h1" style="font-size:3.2em;">
                            <i id="masterButtonIconSmall" class="fa-regular @masterButtonIcon" style="color:#fbfbfb;" onclick="@TogglePlayState" ></i>
                        </span>
                    </div>
                </div>
                <div class="col-2 col-md-2 col-lg-2 col-xl-1 col-xxl-1 d-flex justify-content-center align-items-center" >
                    <input type="range" class="form-range" min="0.0" max="1.0" step="0.01" id="waapiVolumeSliderSmallUI" @bind-value="@AppState.Volume" >
                </div>                
                <div class="col-8 align-items-center" id="smallPlayerDetailsButton" @onclick="@ClckOnTrackDetails">   
                    <div class="row">
                        <span class="h5">Feel The Wrath Of My Beuatiful Screams</span>
                    </div>
                    <div class="row pt-0">
                        <span style="color: #adb5bd;"><em>the Artist Formerly Known As Pasta</em></span>
                    </div> 
                </div>
            </div>
        </div> 
    </Animate>
</footer>    


@code {
    [CascadingParameter] public CascadingAppState AppState { get; set; }

    [Parameter]
    public string FontSize { get; set; }

    [Parameter]
    public string FontColour { get; set; }

    string showBigPlayer = "";
    string showSmallPlayer = "";
    string masterButtonIcon = "";
    string dspGlobalEnableLabel = "";

    [Inject]
    public IJSRuntime JSRuntime { get; set; }

    private IJSObjectReference _jsModule;

    protected override async Task OnInitializedAsync()
    {
        //_jsModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/webaudio.js");

        //await _jsModule.InvokeVoidAsync("loadWebAudio");
    }

    List<RadioCore.StreamSource> streams = Globals.StreamSources();

    private void ClckOnTrackDetails()
    {
        Navigation.NavigateTo("", forceLoad: false, replace: true);
    }

    private async Task TogglePlayState()
    {
        if (AppState.IsPlaying)
        {
            AppState.IsPlaying = false;
        }
        else if (!AppState.IsPlaying)
        {
            AppState.IsPlaying = true;
        }
    }

    private Animate onMouseOver;

    private void RunAnimation()
    {
        onMouseOver.Run();    
    }

    private RequestForm requestForm = new(){ };

    public class RequestForm{
        public string? Name { get; set; }
        public string? Description { get; set; }
        public string? Country { get; set; }
        public string? URL { get; set; }
    }
}